<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API &mdash; Mailtank documentation 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Mailtank documentation 0.1 documentation" href="index.html" />
    <link rel="next" title="Язык разметки шаблонов" href="templates.html" />
    <link rel="prev" title="Mailtank" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="templates.html" title="Язык разметки шаблонов"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Mailtank"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Mailtank documentation 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="api">
<h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id9">Введение</a></li>
<li><a class="reference internal" href="#id2" id="id10">Авторизация</a></li>
<li><a class="reference internal" href="#id3" id="id11">Ресурсы</a><ul>
<li><a class="reference internal" href="#id4" id="id12">Подписчики</a></li>
<li><a class="reference internal" href="#id5" id="id13">Свойства подписчика</a></li>
<li><a class="reference internal" href="#id6" id="id14">Рассылки</a></li>
<li><a class="reference internal" href="#id7" id="id15">Шаблоны</a></li>
<li><a class="reference internal" href="#id8" id="id16">Отписки</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#contents">Введение</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Проект предоставляет RESTful API для управления подписчиками, создания шаблонов
и выполнения рассылок.  Все ответы API имеют <cite>Content-Type: application/json</cite> и
содержат валидный JSON (за исключением ответов c кодом 204). Все запросы к API
также должны иметь <cite>Content-Type: application/json</cite>.</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#contents">Авторизация</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Авторизация производится при помощи ключа доступа, который клиент указывает в
HTTP-заголовке <cite>X-Auth-Token</cite>.  Ключ предоставляет доступ к ресурсам одного
проекта.</p>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#contents">Ресурсы</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#contents">Подписчики</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Информация о подписчике содержит следующие поля:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">does_email_exist</span></tt> (read-only): имеет истинное значение, если Mailtank
не получал уведомлений от внешных систем о том, что данный e-mail не
существует;</li>
<li><tt class="docutils literal"><span class="pre">email</span></tt>: уникальный в рамках проекта e-mail;</li>
<li><tt class="docutils literal"><span class="pre">id</span></tt>: уникальный в рамках проекта идентификатор подписчика;</li>
<li><tt class="docutils literal"><span class="pre">properties</span></tt>: словарь свойств подписчика, которые доступны в шаблоне рассылки;</li>
<li><tt class="docutils literal"><span class="pre">tags</span></tt>: список тегов подписчика;</li>
<li><tt class="docutils literal"><span class="pre">url</span></tt> (read-only): resource URI.</li>
</ul>
<dl class="get">
<dt id="get--subscribers-?page=(int-page)">
<tt class="descname">GET </tt><tt class="descname">/subscribers/?page=</tt><big>(</big><em class="property">int: </em><em>page</em><big>)</big><a class="headerlink" href="#get--subscribers-?page=(int-page)" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает постраничный список подписчиков проекта.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>page</strong> (<em>int</em>) &#8211; (опционально) номер запрашиваемой страницы</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/subscribers/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;objects&quot;: [
        {
            &quot;does_email_exist&quot;: true,
            &quot;email&quot;: &quot;james@doe.com&quot;,
            &quot;id&quot;: &quot;1&quot;,
            &quot;properties&quot;: {
                &quot;age&quot;: 21,
                &quot;first_name&quot;: &quot;James&quot;,
                &quot;last_name&quot;: &quot;Doe&quot;
            },
            &quot;tags&quot;: [
                &quot;test-tag&quot;
            ],
            &quot;url&quot;: &quot;/subscribers/1&quot;
        },
        {
            &quot;does_email_exist&quot;: true,
            &quot;email&quot;: &quot;john@doe.com&quot;,
            &quot;id&quot;: &quot;192f56eb9b&quot;,
            &quot;properties&quot;: {},
            &quot;tags&quot;: [],
            &quot;url&quot;: &quot;/subscribers/192f56eb9b&quot;
        }
    ],
    &quot;page&quot;: 1,
    &quot;pages_total&quot;: 1
}
</pre></div>
</div>
</dd></dl>

<dl class="post">
<dt id="post--subscribers-">
<tt class="descname">POST </tt><tt class="descname">/subscribers/</tt><a class="headerlink" href="#post--subscribers-" title="Permalink to this definition">¶</a></dt>
<dd><p>Создаёт нового подписчика.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Json Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>email</strong> (<em>string</em>) &#8211; e-mail подписчика. Должен быть уникальным в рамках
проекта.</li>
<li><strong>id</strong> (<em>string</em>) &#8211; (опционально) идентификатор подписчика. Должен быть
уникальным в рамках проекта. Будет сгенерирован
системой автоматически, если не указан в запросе.</li>
<li><strong>properties</strong> (<em>dict</em>) &#8211; (опционально) словарь свойств подписчика, ключи
которого являются строками, а значения &#8211;
строками или числами</li>
<li><strong>tags</strong> (<em>list</em>) &#8211; (опционально) список тегов подписчика</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Для создания подписчика достаточно указать e-mail:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/subscribers/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;email&quot;: &quot;john@doe.com&quot;
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">201</span> <span class="ne">CREATED</span>

{
    &quot;does_email_exist&quot;: true,
    &quot;email&quot;: &quot;john@doe.com&quot;,
    &quot;id&quot;: &quot;192f56eb9b&quot;,
    &quot;properties&quot;: {},
    &quot;tags&quot;: [],
    &quot;url&quot;: &quot;/subscribers/192f56eb9b&quot;
}
</pre></div>
</div>
<p>Нельзя создать второго подписчика с одним и тем же адресом:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/subscribers/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;email&quot;: &quot;john@doe.com&quot;
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">400</span> <span class="ne">BAD REQUEST</span>

{
    &quot;email&quot;: [&quot;Entry with such value already exists.&quot;]
}
</pre></div>
</div>
<p>При создании подписчика можно указать идентификатор, теги и свойства:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/subscribers/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;email&quot;: &quot;james@doe.com&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;properties&quot;: {
        &quot;age&quot;: 21,
        &quot;first_name&quot;: &quot;James&quot;,
        &quot;last_name&quot;: &quot;Doe&quot;
    },
    &quot;tags&quot;: [
        &quot;test-tag&quot;
    ]
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">201</span> <span class="ne">CREATED</span>

{
    &quot;does_email_exist&quot;: true,
    &quot;email&quot;: &quot;james@doe.com&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;properties&quot;: {
        &quot;age&quot;: 21,
        &quot;first_name&quot;: &quot;James&quot;,
        &quot;last_name&quot;: &quot;Doe&quot;
    },
    &quot;tags&quot;: [
        &quot;test-tag&quot;
    ],
    &quot;url&quot;: &quot;/subscribers/1&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="put">
<dt id="put--subscribers-(str-id)">
<tt class="descname">PUT </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><a class="headerlink" href="#put--subscribers-(str-id)" title="Permalink to this definition">¶</a></dt>
<dd><p>Обновляет данные подписчика.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Json Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>email</strong> (<em>string</em>) &#8211; (опционально) e-mail подписчика</li>
<li><strong>properties</strong> (<em>dict</em>) &#8211; (опционально) словарь свойств подписчика</li>
<li><strong>tags</strong> (<em>list</em>) &#8211; (опционально) список тегов подписчика</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">PUT</span> <span class="nn">/subscribers/1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;properties&quot;: {
        &quot;age&quot;: 25,
        &quot;first_name&quot;: &quot;James&quot;,
        &quot;last_name&quot;: &quot;Doe&quot;,
        &quot;sex&quot;: &quot;M&quot;
    },
    &quot;tags&quot;: [
        &quot;male&quot;,
        &quot;yet-another-test-tag&quot;
    ]
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;does_email_exist&quot;: true,
    &quot;email&quot;: &quot;james@doe.com&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;properties&quot;: {
        &quot;age&quot;: 25,
        &quot;first_name&quot;: &quot;James&quot;,
        &quot;last_name&quot;: &quot;Doe&quot;,
        &quot;sex&quot;: &quot;M&quot;
    },
    &quot;tags&quot;: [
        &quot;male&quot;,
        &quot;yet-another-test-tag&quot;
    ],
    &quot;url&quot;: &quot;/subscribers/1&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="get">
<dt id="get--subscribers-(str-id)">
<tt class="descname">GET </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><a class="headerlink" href="#get--subscribers-(str-id)" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает данные подписчика.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/subscribers/1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;does_email_exist&quot;: true,
    &quot;email&quot;: &quot;james@doe.com&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;properties&quot;: {
        &quot;age&quot;: 21,
        &quot;first_name&quot;: &quot;James&quot;,
        &quot;last_name&quot;: &quot;Doe&quot;
    },
    &quot;tags&quot;: [
        &quot;test-tag&quot;
    ],
    &quot;url&quot;: &quot;/subscribers/1&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="delete">
<dt id="delete--subscribers-(str-id)">
<tt class="descname">DELETE </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><a class="headerlink" href="#delete--subscribers-(str-id)" title="Permalink to this definition">¶</a></dt>
<dd><p>Удаляет подписчика.</p>
</dd></dl>

<dl class="patch">
<dt id="patch--subscribers-">
<tt class="descname">PATCH </tt><tt class="descname">/subscribers/</tt><a class="headerlink" href="#patch--subscribers-" title="Permalink to this definition">¶</a></dt>
<dd><p>Выполняет операцию над группой подписчиков. Доступные операции:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">reassign_tag</span></tt> — переназначает тег новой группе подписчиков (тег станет
принадлежать указанным подписчикам и только им). Параметры операции
должны содержать:<ul>
<li><tt class="docutils literal"><span class="pre">tag</span></tt> — тег (строка);</li>
<li><tt class="docutils literal"><span class="pre">subscriber</span></tt> — список идентификаторов подписчиков или <tt class="docutils literal"><span class="pre">&quot;all&quot;</span></tt>
для обозначения всех подписчиков проекта.</li>
</ul>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Json Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>action</strong> (<em>string</em>) &#8211; имя операции</li>
<li><strong>data</strong> (<em>dict</em>) &#8211; словарь, содержащий параметры операции</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>После данного запроса тег <tt class="docutils literal"><span class="pre">good</span></tt> станет принадлежать исключительно
подписчикам с идентификаторами <tt class="docutils literal"><span class="pre">1</span></tt> и <tt class="docutils literal"><span class="pre">192f56eb9b</span></tt>. Со всех остальных
подписчиков проекта он будет снят:</p>
<div class="highlight-http"><pre>PATCH /subscribers/ HTTP/1.1

{
    "action": "reassign_tag",
    "data": {
        "subscribers": ["1", "192f56eb9b"],
        "tag": "good"
    }
}</pre>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">204</span> <span class="ne">NO CONTENT</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#contents">Свойства подписчика</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<dl class="get">
<dt id="get--subscribers-(str-id)-properties-">
<tt class="descname">GET </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><tt class="descname">/properties/</tt><a class="headerlink" href="#get--subscribers-(str-id)-properties-" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает словарь свойств подписчика.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/subscribers/1/properties/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;age&quot;: 25,
    &quot;birthdate&quot;: &quot;14.08.1990&quot;,
    &quot;last_name&quot;: &quot;Doe&quot;,
    &quot;sex&quot;: &quot;M&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="get">
<dt id="get--subscribers-(str-id)-properties-(string-name)">
<tt class="descname">GET </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><tt class="descname">/properties/</tt><big>(</big><em class="property">string: </em><em>name</em><big>)</big><a class="headerlink" href="#get--subscribers-(str-id)-properties-(string-name)" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает значение свойства подписчика.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/subscribers/1/properties/first_name</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;value&quot;: &quot;James&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="post">
<dt id="post--subscribers-(str-id)-properties-(string-name)">
<tt class="descname">POST </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><tt class="descname">/properties/</tt><big>(</big><em class="property">string: </em><em>name</em><big>)</big><a class="headerlink" href="#post--subscribers-(str-id)-properties-(string-name)" title="Permalink to this definition">¶</a></dt>
<dd><p>Изменяет значение или создаёт новое свойство подписчика.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/subscribers/1/properties/birthdate</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;value&quot;: &quot;14.08.1990&quot;
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;value&quot;: &quot;14.08.1990&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="delete">
<dt id="delete--subscribers-(str-id)-properties-(string-name)">
<tt class="descname">DELETE </tt><tt class="descname">/subscribers/</tt><big>(</big><em class="property">str: </em><em>id</em><big>)</big><tt class="descname">/properties/</tt><big>(</big><em class="property">string: </em><em>name</em><big>)</big><a class="headerlink" href="#delete--subscribers-(str-id)-properties-(string-name)" title="Permalink to this definition">¶</a></dt>
<dd><p>Удаляет свойство подписчика.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">DELETE</span> <span class="nn">/subscribers/1/properties/first_name</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">204</span> <span class="ne">NO CONTENT</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#contents">Рассылки</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Информация о рассылке содержит следующие поля:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">id</span></tt>: целочисленный идентификатор рассылки;</li>
<li><tt class="docutils literal"><span class="pre">eta</span></tt>: приблизительное время в секундах, через которое закончится рассылка
или <tt class="docutils literal"><span class="pre">null</span></tt>, если рассылка не исполняется в данный момент;</li>
<li><tt class="docutils literal"><span class="pre">status</span></tt>: статус исполнения рассылки. Принимает следующие значения:<ul>
<li><tt class="docutils literal"><span class="pre">&quot;FAILED&quot;</span></tt>, если рассылка завершена неуспешно;</li>
<li><tt class="docutils literal"><span class="pre">&quot;SUCCEEDED&quot;</span></tt>, если рассылка завершена успешно;</li>
<li><tt class="docutils literal"><span class="pre">&quot;ENQUEUED&quot;</span></tt>, если рассылка ожидает своей очереди.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">url</span></tt>: resource URI.</li>
</ul>
<dl class="get">
<dt id="get--mailings-">
<tt class="descname">GET </tt><tt class="descname">/mailings/</tt><a class="headerlink" href="#get--mailings-" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает постраничный список рассылок проекта.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/mailings/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;objects&quot;: [
        {
            &quot;eta&quot;: null,
            &quot;id&quot;: 13,
            &quot;status&quot;: &quot;FAILED&quot;,
            &quot;url&quot;: &quot;/mailings/13&quot;
        },
        {
            &quot;eta&quot;: 0,
            &quot;id&quot;: 14,
            &quot;status&quot;: &quot;SUCCEEDED&quot;,
            &quot;url&quot;: &quot;/mailings/14&quot;
        },
        {
            &quot;eta&quot;: 10,
            &quot;id&quot;: 15,
            &quot;status&quot;: &quot;ENQUEUED&quot;,
            &quot;url&quot;: &quot;/mailings/15&quot;
        },
        {
            &quot;eta&quot;: 20,
            &quot;id&quot;: 16,
            &quot;status&quot;: &quot;ENQUEUED&quot;,
            &quot;url&quot;: &quot;/mailings/16&quot;
        },
        {
            &quot;eta&quot;: null,
            &quot;id&quot;: 17,
            &quot;status&quot;: &quot;ENQUEUED&quot;,
            &quot;url&quot;: &quot;/mailings/17&quot;
        }
    ],
    &quot;page&quot;: 1,
    &quot;pages_total&quot;: 1
}
</pre></div>
</div>
</dd></dl>

<dl class="post">
<dt id="post--mailings-">
<tt class="descname">POST </tt><tt class="descname">/mailings/</tt><a class="headerlink" href="#post--mailings-" title="Permalink to this definition">¶</a></dt>
<dd><p>Создаёт и выполняет рассылку.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Json Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>layout_id</strong> (<em>string</em>) &#8211; идентификатор шаблона, который будет
использован для рассылки</li>
<li><strong>context</strong> (<em>dict</em>) &#8211; словарь, содержащий данные рассылки. Должен
удовлетворять структуре используемого шаблона</li>
<li><strong>target</strong> (<em>dict</em>) &#8211; <dl class="docutils">
<dt>словарь, задающий получателей рассылки.</dt>
<dd>Допустимы следующие поля:</dd>
</dl>
<ul>
<li><tt class="docutils literal"><span class="pre">unsubscribe_tags</span></tt>: список тегов, которые буду сняты с подписчика
при отписке. Поле обязательно, если <tt class="docutils literal"><span class="pre">контекст</span></tt> не содержит
<tt class="docutils literal"><span class="pre">unsubscribe_link</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">tags_union</span></tt>: (по умолчанию &#8211; false) задаёт логику интерпретации
списка тегов (пересечение или объединение, см. ниже);</li>
<li><tt class="docutils literal"><span class="pre">tags_and_receivers_union</span></tt>: (по умолчанию &#8211; false) задаёт логику
интерпретации наличия и списка тегов, и списка идентификаторов
(пересечение или объединение, см.ниже).</li>
<li><tt class="docutils literal"><span class="pre">subscribers</span></tt>: список идентификаторов подписчиков, явно задающий
группу подписчиков;</li>
<li><tt class="docutils literal"><span class="pre">tags</span></tt>: список тегов, задающий группу подписчиков следующим образом:<blockquote>
<div><ul>
<li>если <tt class="docutils literal"><span class="pre">tags_union</span></tt> имеет ложное значение &#8211; в группу входят
подписчики, каждый из которых имеет все из перечисленных тегов;</li>
<li>если <tt class="docutils literal"><span class="pre">tags_union</span></tt> имеет истинное значение &#8211; в группу входят
подписчики, каждый из которых имеет хотя бы один из перечисленных
тегов.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>Логика интерпретации полей</strong>:</p>
<ul>
<li>Если указаны поля и <tt class="docutils literal"><span class="pre">tags</span></tt>, и <tt class="docutils literal"><span class="pre">subscribers</span></tt>, то рассылка будет
послана:<blockquote>
<div><ul>
<li>если <tt class="docutils literal"><span class="pre">tags_and_receivers_union</span></tt> имеет ложное значение &#8211;
подписчикам, входящим в обе группы (пересечение);</li>
<li>если <tt class="docutils literal"><span class="pre">tags_and_receivers_union</span></tt> имеет истинное значение &#8211;
подписчикам, входящим по меньше мере в одну из групп
(объединение).</li>
</ul>
</div></blockquote>
</li>
<li>Если указано лишь одно из полей <tt class="docutils literal"><span class="pre">tags</span></tt> и <tt class="docutils literal"><span class="pre">subscribers</span></tt>, рассылка
будет послана подписчика из группы, заданной этим полем.</li>
<li>Словарь должен содержать по меньшей мере одно из полей <tt class="docutils literal"><span class="pre">subscribers</span></tt>
и <tt class="docutils literal"><span class="pre">tags</span></tt>.</li>
</ul>
</li>
<li><strong>attachments</strong> (<em>list</em>) &#8211; <dl class="docutils">
<dt>(опционально) список словарей, содержащих</dt>
<dd>следующие поля:</dd>
</dl>
<ul>
<li><tt class="docutils literal"><span class="pre">name</span></tt>: имя вложения;</li>
<li><tt class="docutils literal"><span class="pre">data</span></tt>: закодированное в BASE64 содержимое файла;</li>
<li><tt class="docutils literal"><span class="pre">mimetype</span></tt>: MIME-тип вложения.</li>
</ul>
<p>Суммарный объём файлов после декодирования не должен превышать 10 МБ.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/mailings/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;attachments&quot;: [
        {
            &quot;data&quot;: &quot;SGVsbG8h&quot;,
            &quot;mimetype&quot;: &quot;text/plain&quot;,
            &quot;name&quot;: &quot;hello.txt&quot;
        }
    ],
    &quot;context&quot;: {
        &quot;name&quot;: &quot;Anton&quot;
    },
    &quot;layout_id&quot;: &quot;56929c1607&quot;,
    &quot;target&quot;: {
        &quot;tags&quot;: [
            &quot;test-tag&quot;,
            &quot;male&quot;
        ],
        &quot;tags_and_receivers_union&quot;: true,
        &quot;unsubscribe_tags&quot;: [
            &quot;test-tag&quot;
        ]
    }
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">201</span> <span class="ne">CREATED</span>

{
    &quot;eta&quot;: null,
    &quot;id&quot;: 16,
    &quot;status&quot;: &quot;ENQUEUED&quot;,
    &quot;url&quot;: &quot;/mailings/16&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="get">
<dt id="get--mailings-(int-id)">
<tt class="descname">GET </tt><tt class="descname">/mailings/</tt><big>(</big><em class="property">int: </em><em>id</em><big>)</big><a class="headerlink" href="#get--mailings-(int-id)" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает данные рассылки.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/mailings/17</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;eta&quot;: 20,
    &quot;id&quot;: 17,
    &quot;status&quot;: &quot;ENQUEUED&quot;,
    &quot;url&quot;: &quot;/mailings/17&quot;
}
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#contents">Шаблоны</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<dl class="post">
<dt id="post--layouts-">
<tt class="descname">POST </tt><tt class="descname">/layouts/</tt><a class="headerlink" href="#post--layouts-" title="Permalink to this definition">¶</a></dt>
<dd><p>Создаёт шаблон с единственным вариантом.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Json Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) &#8211; имя шаблона</li>
<li><strong>markup</strong> (<em>string</em>) &#8211; разметка единственного варианта шаблона</li>
<li><strong>subject_markup</strong> (<em>string</em>) &#8211; разметка темы шаблона</li>
<li><strong>plaintext_markup</strong> (<em>string</em>) &#8211; (опционально) разметка текстовой версии
шаблона</li>
<li><strong>base</strong> (<em>string</em>) &#8211; (опционально) идентификатор родительского базового
шаблона</li>
<li><strong>id</strong> (<em>string</em>) &#8211; (опционально) идентификатор шаблона. Должен быть
уникальным в рамках проекта. Будет сгенерирован
системой автоматически, если не указан в запросе.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/layouts/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;markup&quot;: &quot;&lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;&lt;br&gt;&lt;a href=\&quot;{{ unsubscribe_link }}\&quot;&gt;Unsubscribe&lt;/a&gt;&quot;,
    &quot;name&quot;: &quot;Default&quot;,
    &quot;subject_markup&quot;: &quot;Just a hello&quot;
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;id&quot;: &quot;56929c1607&quot;
}
</pre></div>
</div>
</dd></dl>

<dl class="post">
<dt id="post--base_layouts-">
<tt class="descname">POST </tt><tt class="descname">/base_layouts/</tt><a class="headerlink" href="#post--base_layouts-" title="Permalink to this definition">¶</a></dt>
<dd><p>Создаёт базовый шаблон.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Json Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) &#8211; имя</li>
<li><strong>markup</strong> (<em>string</em>) &#8211; разметка</li>
<li><strong>id</strong> (<em>string</em>) &#8211; (опционально) идентификатор базового шаблона. Должен
быть уникальным в рамках проекта. Будет сгенерирован
системой автоматически, если не указан в запросе.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/base_layouts/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;markup&quot;: &quot;&lt;div&gt;{% block content %}&lt;a href=\&quot;{{ unsubscribe_link }}\&quot;&gt;Unsubscribe&lt;/a&gt;{% endblock %}&lt;/div&gt;&quot;,
    &quot;name&quot;: &quot;Default&quot;
}
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;id&quot;: &quot;271f93f45e&quot;
}
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#contents">Отписки</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Информация об отписке содержит следующие поля:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">mailing_id</span></tt>: целочисленный идентификатор рассылки;</li>
<li><tt class="docutils literal"><span class="pre">subscriber_id</span></tt>: идентификатор подписчика;</li>
<li><tt class="docutils literal"><span class="pre">created_at</span></tt>: время события в формате ISO;</li>
<li><tt class="docutils literal"><span class="pre">tags</span></tt>: теги, по которым был выбран подписчик при осуществлении рассылки;</li>
<li><tt class="docutils literal"><span class="pre">type</span></tt>: строка <cite>action</cite> (пользователь действительно отписался) или <cite>intent</cite>
(пользователь просмотрел страницу отписки).</li>
</ul>
<dl class="get">
<dt id="get--unsubscribed-?page=(int-page)">
<tt class="descname">GET </tt><tt class="descname">/unsubscribed/?page=</tt><big>(</big><em class="property">int: </em><em>page</em><big>)</big><a class="headerlink" href="#get--unsubscribed-?page=(int-page)" title="Permalink to this definition">¶</a></dt>
<dd><p>Возвращает постраничный список отписок подписчиков.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><ul class="first last simple">
<li><strong>page</strong> (<em>int</em>) &#8211; (опционально) номер запрашиваемой страницы</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/unsubscribed/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>

{
    &quot;objects&quot;: [
        {
            &quot;mailing_id&quot;: 1,
            &quot;subscriber_id&quot;: &quot;1&quot;,
            &quot;created_at&quot;: &quot;2013-10-03T10:49:01.658949&quot;,
            &quot;tags&quot;: [&quot;good&quot;, &quot;bad&quot;],
            &quot;type&quot;: &quot;intent&quot;
        },
        {
            &quot;mailing_id&quot;: 2,
            &quot;subscriber_id&quot;: &quot;s139sw&quot;,
            &quot;created_at&quot;: &quot;2013-13-03T13:34:51.123901&quot;,
            &quot;tags&quot;: [&quot;good&quot;],
            &quot;type&quot;: &quot;action&quot;
        }
    ],
    &quot;page&quot;: 1,
    &quot;pages_total&quot;: 1
}
</pre></div>
</div>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">API</a><ul>
<li><a class="reference internal" href="#id1">Введение</a></li>
<li><a class="reference internal" href="#id2">Авторизация</a></li>
<li><a class="reference internal" href="#id3">Ресурсы</a><ul>
<li><a class="reference internal" href="#id4">Подписчики</a></li>
<li><a class="reference internal" href="#id5">Свойства подписчика</a></li>
<li><a class="reference internal" href="#id6">Рассылки</a></li>
<li><a class="reference internal" href="#id7">Шаблоны</a></li>
<li><a class="reference internal" href="#id8">Отписки</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Mailtank</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="templates.html"
                        title="next chapter">Язык разметки шаблонов</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/api.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="templates.html" title="Язык разметки шаблонов"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Mailtank"
             >previous</a> |</li>
        <li><a href="index.html">Mailtank documentation 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mailtank developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>